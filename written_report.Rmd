---
title: "Predicting the Cost of Hotel Booking in the United States"
author: "LAM-duh: Xuliang Deng, Leah Okamura, Megan Richards"
date: "Nov 15th, 2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages,include=FALSE}
library(tidyverse)
library(broom)
library(knitr)
library(ggfortify)
``` 

```{r load-data,include=FALSE}
hotels <- read_csv("data/hotels_reduced.csv")
```

### Introduction 

With the lifting of travel restrictions into the U.S. (https://www.nytimes.com/2021/09/22/travel/us-international-travel-vaccine.html) through the implementation of new travel guidelines, we believe that travel to the U.S. start to increase and look like as it did before the pandemic. Therefore, with travel and tourism in the U.S. increasing, we believe that the booking of hotels may start to increase as well. With this assumption, with the slower return to travel and society pre covid, we are interested in studying the characteristics of hotel room reservations in the United States. Specifically, we are interested in what relationship these characteristics have with the cost of a hotel. Our general research question is: How do the characteristics of a hotel booking affect the daily cost of a hotel stay in the United States? We believe there will be several significant points of relevance for understanding these relationships: understanding predictors of room cost could be used to help identify where new hotels could be successfully created, allow travelers to plan financially for future travel, allow hotels to predict future profit, etc. In this report, we are looking to use a variety of chosen models to understand the contributing factors to hotel room price, as well as identify the strongest predictors in the determining the avreage daily rate.

### Data 

The source of the dataset is Tiny Tuesday, https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-11/readme.md.
This data set was originally collected from an open hotel booking demand dataset from Antonio, Almeida and Nunes, 2019. The data collected from hotels all around the world ranges from bookings in 2015 to 2017. It is sourced from this study https://www.sciencedirect.com/science/article/pii/S2352340918315191#f0010. Due to the dataset being over 100,000 observations, we have limited the observations to be only hotels from the US. The general characteristics being measured in the data are the different aspects of booking and staying at a hotel. For example, out of the 32 variables, some of the ones we find great interest in are hotel type, reserved room type, assigned room type, company, meal, number of adults/children/babies, the average daily rate or daily cost, and the reservation status. Therefore, each observation is one booking/stay at a specific hotel in America and all of its characteristics. Therefore, there can be multiple observations from the same hotel and even on the same time range. The full dataset dictionary can be found in the repository ReadMe. 

### Resesarch Question 

To better understand the contributing factors to the daily rate of hotel rooms in the U.S., we will build models to:

1) Evaluate the efficacy of this model to predict daily hotel room rates
2) Evaluate the statistical significance of each predictor, identifying the strongest contributing factors. We include the following variables in our analysis: hotel type, company, meal, number of adults/children/babies, the average daily rate or daily cost, and the reservation status.

### Exploratory data analysis

```{r make-total-stay-var}
hotels$total_stay_length <- hotels$stays_in_week_nights + hotels$stays_in_weekend_nights
```

```{r response-plot}
ggplot(data = hotels, aes(x = adr)) +
  geom_histogram() + 
  labs(x = "Price in US Dollars",
       y = "Frequency", 
       title = "Distribution of Average Daily Rate (Cost) of Hotel Bookings",
       subtitle = "Collected from Hotels in the U.S. from 2015-2017")

```

```{r summary stats}
hotels %>%
    summarise(mean = mean(adr), 
              median = median(adr), 
              sd = sd(adr),
              min = min(adr),
              max = max(adr),
              iqr = IQR(adr))%>%
kable(digits = 3)
```

The response variable, adr, has a somewhat skewed right, bimodal distribution. The average or mean average daily rate is \$122.992 and the median is $115. Because the distribution is skewed, the median is most likely the best indicator for the center. The standard deviation is \$51.617 and the data ranges from \$0 to \$328.33 with an interquartile range of \$61.99.

```{r}
adults <- sum(hotels$adults)
children <- sum(hotels$children)
babies <- sum(hotels$babies)

tb <- table(adults, children, babies)
kable(tb)
```

This table provides insight on the type of people who were booking hotels in the U.S. during this time period. A large majority of customers were only adults with a total of 3,950 hotel bookings. The next largest customer group were people or adults with their children at a total of 362 bookings. Lastly, those who booked a stay with a baby was considerably less, with only 6 bookings.

```{r}
ggplot(data = hotels, aes(x = meal)) +
geom_bar() +
labs(title = "Distribution of Meal Plan According to Booking Details",
      y = "Frequency",
      x = "Type of Meal Plan") 
```

```{r}
hotels %>%
  group_by(meal) %>%
  summarise(n = n(), mean = mean(adr), sd = sd(adr)) %>%
  kable(digits = 3)
```

We can see that majority of customer bookings chose the Bed and Breakfast plan (BB), rather than Half Board plan or Full Board (HB and SC). While this does reflect the choice of those booking the hotel, this visualization and dataset can also be influenced by what type of meal plan each hotel is offering. 

```{r}
ggplot(data = hotels, aes(x = reservation_status)) +
geom_bar() +
labs(title = "Distribution of Reservation Status",
  x = "Type of Status",
  y = "Frequency") 
```
A vast majority of the reservation statuses in this dataset resulted in a check-out, meaning that the customer arrived and stayed for the duration of the stay. It also important to note that a substantial proportion of hotel bookings were canceled, and if possible we would like to investigate what relationship might exist here.

```{r}
hotels %>%
  group_by(hotel) %>%
  summarise(n = n(), mean = mean(adr), sd = sd(adr)) %>%
  kable(digits = 3)
```
We can see that resort hotel is on average more expensive, and that most customers booked at city hotels. We are interested in whether the classification of City Hotel and Resort Hotel will proportionately have similar relationships with the other variables.

```{r}
ggplot(data = hotels, aes(x = lead_time, y = adr, color = hotel)) +
geom_point() +
labs(title = "Relationship between how early people book hotel and price in the US dollars",
  x = "Subtraction of entering date from arrival date",
  y = "Price in the US Dollars") 
```
We can see that the more last minute visitors book a hotel, the more likely it is that the price in the US dollars varies. Besides, we can also see that the highest price in a hotel decreases as the difference between entering data and arrival date increases. This could suggest that the earlier you book a hotel, the price is more likely to be cheap. 

```{r}
ggplot(data = hotels, aes(x = adr, y = arrival_date_day_of_month, color=hotel)) +
geom_point() +
labs(title = "Relationship between day in the month when hotels are booked and price in the US dollars",
  x = "Day in the month",
  y = "Price in US Dollars") 
```
We cannot see any significant relationship between day in the month and the hotel price from this figure. However, we can see that summer is the busiest season for hotels and the price varies evenly. At the beginning of the year and the end of the year, hotels are not really booked as often. 

```{r}
ggplot(data = hotels, aes(x = arrival_date_week_number, y = adr, color=hotel)) +
geom_point() +
labs(title = "Relationship between week in the year when hotels are booked and price in the US dollars",
  x = "Week in the year",
  y = "Price in US Dollars") 
```
From this figure, we can also see that at the beginning and end of the year hotels are not as busy as during the summer. Besides, we can also observe that the price of hotel tends to become higher during summer time compared to the rest of the year. 



## Methodology

### Modeling Choices (Description) 
- Data transformations (if applied)
- Model Type Justification 
- Model selection criteria 
- Handling Interaction Terms 
- Any other technical choices 

It is important to note that there are a few variables in the dataset that do not provide insight to our research question and as a result we will remove from the dataset. First is the category `hotels$country`, due to the fact that every hotel in this subset of the data is located in the U.S., this is a redundant variable. Next, the two variables `hotels$reserved_room_type` and `hotels$assigned_room_type` are both categorical variables that have letters assigned to each room type. However, due to the confidentiality of the customers, the classification of these letters have not been identified by those who collected the data. Therefore, we will be removing these variables from the dataset.

```{r}
hotels$country <- NULL 
hotels$reserved_room_type <- NULL 
hotels$assigned_room_type <- NULL 
```


As of now, we know we are going to use hotel (Resort Hotel or City Hotel), company, customer_type, stays_in_weekend_nights, stays_in_week_nights, and  meal(type of meal) as predictor variables. We are interested in how the food is served at a hotel and what type of hotel can indicate how much a night in a hotel could cost. As we explore more of the relationships in our dataset, we may add other possible predictor variables as we see fit.

We plan to use multiple linear regression with a variety of combinations of interested predictor variables and their interaction. Based on whether conditions or fit or not or based on the visualization, we believe we may be utilizing logarithmic regression as well. We would also be interested in seeing how stays in the weekend or the weekday may affect the average daily rate for a hotel, and if they differ between the two hotel types, City and Resort hotels.

### Modeling 

```{r}
model <- lm(adr ~ adults + children + babies + hotel + meal + reservation_status, data = hotels)
```

### Conditions Check For Linear Model  

```{r }
# Residual + QQ Plots
autoplot(model, which = c(1,2))
```
• Linearity The residuals are randomly scattered in the plot of residuals vs fitted, so the linearity condition is satisfied.
• Constant variance: The spread of the residuals is approximately equal in the plot of residuals vs. fitted as the fitted value increases. There are a few outliers, but overall the spread of the residuals is equal. Therefore constant variance is satisfied.
• Normality: The QQ-plot shows that the distribution of the residuals is skewed right, so this condition is not satisfied. However, the model is robust to deviations from normality for sample sizes greater than 30. Our sample size of 1447 is greater than 30, so we can proceed.
• Independence: This condition is not met since there are multiple observations for most lemurs. These observations would be correlated

From this analysis, we conclude that the conditions are met for performing  linear regression. 


## Results

```{r modeling}
tidy(model, conf.int = TRUE) %>%
kable(digits = 3)
```

$$\hat{Average Daily Rate} = 79.723	 + 79.723	(adults) + 35.169(children)$$
$$ -22.637(babies) + 2.353(hotel Resort Hotel) + 33.779 (mealHB) - 17.205(mealSc)$$
$$+106.033(mealUndefined)-12.809(reservationstatusCheck-Out) - 2.662(reservationstatusNo-Show)$$

### Diagnostics 

```{r}
autoplot(model, which = c(3, 4, 5))

#Leverage 
lev_threshold <- 2 * 2 / nrow(hotels) 
hotel_aug <- augment(model) 

hotel_aug %>%
filter(.hat > lev_threshold) %>% nrow()

# High Magnitude Residual 
hotel_aug %>%
filter(.std.resid < -3 | .std.resid > 3) %>% nrow()

# Influential Point 
hotel_aug %>%
filter(.cooksd > 1.0) %>% nrow()
 
```
We use leverage and Cook's Distance to identify influential observations in our dataset, and use standardized residuals to identify outliers. 

Leverage is a measure of the distance between an observation's values of the predictor variables and the average values of the predictor variables for the entire data set. We define a high leverage point as having a leverage greater than $ 2(p+1) /n  $, where p is the number of predictors and n is the number of observations. We find X observations to be high leverage, and consider them to be
potential influential points. 

Cook's distance is a composite measure of an observation's leverage and standardized residual, and is used to identify influential points. An observation is considered an influential point if it’s Cook’s distance is greater than 1.0. We find X observations with a Cook's distance greater than 1.0, and conclude that they are influential points. 


Standardized residuals can be used to identify outliers, as observations that have standardized residuals of large magnitude don't fit the pattern determined by the regression model. We identify outliers as observations with standardized residuals with a magnitude greater than or equal to 3. We find X observations to be outliers.

```{r plot_outliers}
hotel_aug <- hotel_aug %>%
mutate(outlier = if_else(.std.resid < -3 | .std.resid > 3, "Yes", "No"))

ggplot(hotel_aug, aes(x = adults, y = adr)) + geom_point(aes(color = outlier)) +
geom_smooth(method = "lm", se = FALSE) + labs(title = "PLotting of Outliers",
      y = "Average Daily Rate",
      x = "Adults") 
```

### Model Assumptions, Limitations

### Interpretations and Conclusions 


